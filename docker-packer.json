{
  "variables": {
    "docker_user": "{{env `DOCKER_USER`}}",
    "docker_password": "{{env `DOCKER_PASSWORD`}}",
    "docker_email": "{{env `DOCKER_EMAIL`}}"
  },

  "builders":[{
    "type": "docker",
    "image": "ruby:2.2.3",
    "commit": true,
    "login_email": "{{user `docker_email`}}",
    "login_username": "{{user `docker_user`}}",
    "login_password": "{{user `docker_password`}}"
  }],

  "provisioners":[
    {
      "type": "shell",
      "inline": [
        "apt-get -y update",
        "apt-get install -y libgecode-dev unzip",
        "mkdir packer",
        "cd packer",
        "wget https://releases.hashicorp.com/packer/0.8.6/packer_0.8.6_linux_amd64.zip",
        "unzip *.zip",
        "ln -s /packer/packer /usr/local/bin/packer"
      ]
    }
  ],

  "post-processors": [
    [
      {
        "type": "docker-tag",
        "repository": "diamond29/packer",
        "tag": "0.2"
      },
      "docker-push"
    ]
  ]
}
